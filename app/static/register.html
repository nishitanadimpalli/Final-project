<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
</head>
<body>
    <h1>Register</h1>

    <label>
        Email:
        <input type="email" id="email">
    </label>
    <br>

    <label>
        Username:
        <input type="text" id="username">
    </label>
    <br>

    <label>
        Password:
        <input type="password" id="password">
    </label>
    <br>

    <label>
        Confirm Password:
        <input type="password" id="confirm">
    </label>
    <br>

    <button onclick="doRegister()">Register</button>

    <p id="message"></p>

    <p>
        Already have an account?
        <a href="/login-page">Go to Login</a>
    </p>

    <script>
        async function doRegister() {
            const email = document.getElementById("email").value.trim();
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value.trim();
            const confirm = document.getElementById("confirm").value.trim();
            const messageEl = document.getElementById("message");

            if (!email || !username || !password || !confirm) {
                messageEl.textContent = "Please fill all fields.";
                return;
            }

            if (password !== confirm) {
                messageEl.textContent = "Passwords do not match.";
                return;
            }

            try {
                const response = await fetch("/users/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, username, password })
                });

                const data = await response.json().catch(() => ({}));

                if (!response.ok) {
                    // API returns {"detail": "..."} for errors
                    if (data.detail) {
                        messageEl.textContent = data.detail;
                    } else {
                        messageEl.textContent = "Registration failed.";
                    }
                    return;
                }

                messageEl.textContent = "Registration successful!";
            } catch (err) {
                console.error(err);
                messageEl.textContent = "Network error.";
            }
        }
    </script>
</body>
</html>
